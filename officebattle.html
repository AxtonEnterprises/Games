<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Battle</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const OfficeBattle = () => {
            const enemies = [
                { name: "Budget", icon: "ðŸ§¾", hp: 30, attacks: [
                    { name: "Spreadsheet Error", damage: 6 },
                    { name: "Missing Receipt", damage: 8 },
                    { name: "Audit Request", damage: 10 }
                ]},
                { name: "Middle Manager", icon: "ðŸ‘”", hp: 35, attacks: [
                    { name: "Micromanage", damage: 7 },
                    { name: "Status Update Request", damage: 8 },
                    { name: "Synergy Speech", damage: 9 }
                ]},
                { name: "Team Meeting", icon: "ðŸ“…", hp: 40, attacks: [
                    { name: "Could've Been an Email", damage: 6 },
                    { name: "Going Around the Room", damage: 9 },
                    { name: "No Clear Agenda", damage: 11 }
                ]},
                { name: "TPS Report", icon: "ðŸ“‹", hp: 28, attacks: [
                    { name: "Missing Cover Sheet", damage: 7 },
                    { name: "Wrong Format", damage: 8 },
                    { name: "Needs Revision", damage: 9 }
                ]}
            ];

            const initialTeam = [
                { 
                    name: "Jen from Accounting", 
                    icon: "ðŸ‘©â€ðŸ’»", 
                    maxHP: 40,
                    hp: 40,
                    specialUsed: false,
                    defeatMessage: "The numbers aren't matching",
                    attacks: [
                        { name: "Data Entry", damage: 5 },
                        { name: "Pivot Table", damage: 25, special: true }
                    ]
                },
                { 
                    name: "Frank the IT Guy", 
                    icon: "ðŸ¦Ž", 
                    maxHP: 45,
                    hp: 45,
                    specialUsed: false,
                    defeatMessage: "Have you seen my gecko?",
                    attacks: [
                        { name: "Turn It Off and On", damage: 6 },
                        { name: "Deploy Firewall", damage: 28, special: true }
                    ]
                },
                { 
                    name: "Trent from Sales", 
                    icon: "ðŸ“ž", 
                    maxHP: 38,
                    hp: 38,
                    specialUsed: false,
                    defeatMessage: "*bbrrrnnngg* got to take this call!",
                    attacks: [
                        { name: "Cold Call", damage: 5 },
                        { name: "Close the Deal", damage: 26, special: true }
                    ]
                },
                { 
                    name: "Jerry from Facilities", 
                    icon: "ðŸ”§", 
                    maxHP: 50,
                    hp: 50,
                    specialUsed: false,
                    defeatMessage: "I'm going to have to order a part",
                    attacks: [
                        { name: "Fix the AC", damage: 4 },
                        { name: "Emergency Maintenance", damage: 24, special: true }
                    ]
                }
            ];

            const [currentEnemyIndex, setCurrentEnemyIndex] = useState(0);
            const [defeatedEnemies, setDefeatedEnemies] = useState([]);
            const [currentPlayerIndex, setCurrentPlayerIndex] = useState(0);
            const [team, setTeam] = useState(initialTeam);
            const [enemyHP, setEnemyHP] = useState(enemies[0].hp);
            const [message, setMessage] = useState(`A wild ${enemies[0].name} appears!`);
            const [isPlayerTurn, setIsPlayerTurn] = useState(true);
            const [gameOver, setGameOver] = useState(false);
            const [showPopup, setShowPopup] = useState(true);
            const [showAttackPopup, setShowAttackPopup] = useState(false);
            const [showTeamSelect, setShowTeamSelect] = useState(false);
            const [switchingPlayer, setSwitchingPlayer] = useState(false);
            const [allEnemiesDefeated, setAllEnemiesDefeated] = useState(false);

            const currentEnemy = enemies[currentEnemyIndex];
            const currentPlayer = team[currentPlayerIndex];

            const playerAttack = (damage, attackName, isSpecial) => {
                if (!isPlayerTurn || gameOver) return;
                
                const newEnemyHP = Math.max(0, enemyHP - damage);
                setEnemyHP(newEnemyHP);
                setMessage(`${currentPlayer.name} used ${attackName}! Dealt ${damage} damage!`);
                setShowAttackPopup(true);
                
                if (isSpecial) {
                    const updatedTeam = [...team];
                    updatedTeam[currentPlayerIndex] = { ...updatedTeam[currentPlayerIndex], specialUsed: true };
                    setTeam(updatedTeam);
                }
                
                if (newEnemyHP <= 0) {
                    setTimeout(() => {
                        setShowAttackPopup(false);
                        const newDefeatedEnemies = [...defeatedEnemies, currentEnemyIndex];
                        setDefeatedEnemies(newDefeatedEnemies);
                        
                        if (newDefeatedEnemies.length === enemies.length) {
                            setMessage("All Crises Defeated! Victory!");
                            setAllEnemiesDefeated(true);
                            setGameOver(true);
                            setShowPopup(true);
                        } else {
                            setMessage("Crisis Defeated!");
                            setGameOver(true);
                            setShowPopup(true);
                        }
                    }, 1500);
                    return;
                }
                
                setIsPlayerTurn(false);
                setTimeout(() => {
                    setShowAttackPopup(false);
                    enemyAttack();
                }, 1500);
            };

            const enemyAttack = () => {
                const attack = currentEnemy.attacks[Math.floor(Math.random() * currentEnemy.attacks.length)];
                const newPlayerHP = Math.max(0, team[currentPlayerIndex].hp - attack.damage);
                
                const updatedTeam = [...team];
                updatedTeam[currentPlayerIndex] = { ...updatedTeam[currentPlayerIndex], hp: newPlayerHP };
                setTeam(updatedTeam);
                
                setMessage(`${currentEnemy.name} used ${attack.name}! Dealt ${attack.damage} damage!`);
                setShowAttackPopup(true);
                
                if (newPlayerHP <= 0) {
                    setTimeout(() => {
                        setShowAttackPopup(false);
                        setMessage(currentPlayer.defeatMessage);
                        setShowAttackPopup(true);
                        
                        const aliveMembers = updatedTeam.filter(member => member.hp > 0);
                        if (aliveMembers.length === 0) {
                            setTimeout(() => {
                                setShowAttackPopup(false);
                                setMessage("Please sign this Performance Improvement Plan!");
                                setGameOver(true);
                                setShowPopup(true);
                            }, 1500);
                        } else {
                            setTimeout(() => {
                                setShowAttackPopup(false);
                                const nextAliveIndex = updatedTeam.findIndex(member => member.hp > 0);
                                setCurrentPlayerIndex(nextAliveIndex);
                                setMessage(`${updatedTeam[nextAliveIndex].name} steps in!`);
                                setShowAttackPopup(true);
                                setTimeout(() => {
                                    setShowAttackPopup(false);
                                    setMessage(`What will ${updatedTeam[nextAliveIndex].name} do?`);
                                    setIsPlayerTurn(true);
                                }, 1500);
                            }, 1500);
                        }
                    }, 1500);
                    return;
                }
                
                setTimeout(() => {
                    setShowAttackPopup(false);
                    setMessage(`What will ${currentPlayer.name} do?`);
                    setIsPlayerTurn(true);
                }, 1500);
            };

            const nextBattle = () => {
                let nextEnemyIndex = (currentEnemyIndex + 1) % enemies.length;
                while (defeatedEnemies.includes(nextEnemyIndex) && defeatedEnemies.length < enemies.length) {
                    nextEnemyIndex = (nextEnemyIndex + 1) % enemies.length;
                }
                
                setCurrentEnemyIndex(nextEnemyIndex);
                setEnemyHP(enemies[nextEnemyIndex].hp);
                setMessage(`A wild ${enemies[nextEnemyIndex].name} appears!`);
                setIsPlayerTurn(true);
                setGameOver(false);
                setShowPopup(true);
                setShowAttackPopup(false);
            };

            const resetGame = () => {
                setTeam(initialTeam);
                setCurrentEnemyIndex(0);
                setDefeatedEnemies([]);
                setCurrentPlayerIndex(0);
                setEnemyHP(enemies[0].hp);
                setMessage(`A wild ${enemies[0].name} appears!`);
                setIsPlayerTurn(true);
                setGameOver(false);
                setShowPopup(true);
                setShowAttackPopup(false);
                setAllEnemiesDefeated(false);
            };

            const selectTeamMember = (index) => {
                if (team[index].hp <= 0) return;
                
                setCurrentPlayerIndex(index);
                setShowTeamSelect(false);
                
                if (switchingPlayer) {
                    setMessage(`Switched to ${team[index].name}!`);
                    setShowAttackPopup(true);
                    setSwitchingPlayer(false);
                    setIsPlayerTurn(false);
                    setTimeout(() => {
                        setShowAttackPopup(false);
                        enemyAttack();
                    }, 1500);
                } else {
                    setShowPopup(true);
                }
            };

            const openTeamSelect = () => {
                setSwitchingPlayer(true);
                setShowTeamSelect(true);
            };

            const closePopup = () => {
                if (allEnemiesDefeated) {
                    resetGame();
                } else if (gameOver) {
                    nextBattle();
                } else {
                    setShowPopup(false);
                    setMessage(`What will ${currentPlayer.name} do?`);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-b from-blue-100 to-blue-200 p-4 flex items-center justify-center">
                    <div className="max-w-3xl w-full">
                        <h1 className="text-4xl font-bold text-center mb-6 text-gray-800">
                            Office Battle
                        </h1>

                        {showTeamSelect && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-8 shadow-2xl max-w-2xl">
                                    <h2 className="text-2xl font-bold text-center mb-6">
                                        {switchingPlayer ? "Switch to..." : "Choose Your Champion"}
                                    </h2>
                                    <div className="grid grid-cols-2 gap-4">
                                        {team.map((member, index) => (
                                            <button
                                                key={index}
                                                onClick={() => selectTeamMember(index)}
                                                disabled={member.hp <= 0}
                                                className={`${member.hp <= 0 ? 'bg-gray-200 opacity-50 cursor-not-allowed' : 'bg-blue-50 hover:bg-blue-100'} border-2 border-blue-300 rounded-lg p-4 transition-all transform hover:scale-105 disabled:transform-none`}
                                            >
                                                <div className="text-5xl mb-2">{member.icon}</div>
                                                <div className="font-bold text-sm">{member.name}</div>
                                                <div className="text-xs text-gray-600">HP: {member.hp}/{member.maxHP}</div>
                                            </button>
                                        ))}
                                    </div>
                                    {switchingPlayer && (
                                        <button
                                            onClick={() => {
                                                setShowTeamSelect(false);
                                                setSwitchingPlayer(false);
                                            }}
                                            className="w-full mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg"
                                        >
                                            Cancel
                                        </button>
                                    )}
                                </div>
                            </div>
                        )}

                        {showPopup && !showTeamSelect && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-8 shadow-2xl max-w-md">
                                    <p className="text-2xl font-bold text-center mb-6">{message}</p>
                                    <button
                                        onClick={closePopup}
                                        className="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg"
                                    >
                                        {allEnemiesDefeated ? "Play Again" : gameOver ? "Next Battle" : "Let's Battle!"}
                                    </button>
                                </div>
                            </div>
                        )}

                        {showAttackPopup && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-8 shadow-2xl max-w-md">
                                    <p className="text-xl font-bold text-center">{message}</p>
                                </div>
                            </div>
                        )}
                        
                        <div className="mb-6">
                            <div className="flex justify-start mb-4">
                                <div className="bg-white rounded-lg p-4 shadow-lg">
                                    <h2 className="text-xl font-bold text-red-600 mb-3 text-center">{currentEnemy.name}</h2>
                                    <div className="border-4 border-red-400 rounded-lg p-6 bg-red-50 mb-3">
                                        <div className="text-6xl">{currentEnemy.icon}</div>
                                    </div>
                                    <div className="w-40">
                                        <div className="text-xs font-bold mb-1 text-gray-700">HP</div>
                                        <div className="w-full bg-gray-200 rounded-full h-5">
                                            <div 
                                                className="bg-red-500 h-5 rounded-full transition-all duration-500 flex items-center justify-center text-white text-xs font-bold"
                                                style={{ width: `${(enemyHP / currentEnemy.hp) * 100}%` }}
                                            >
                                                {enemyHP > 0 && `${enemyHP}/${currentEnemy.hp}`}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="text-5xl font-bold text-gray-400 text-center mb-4">VS</div>

                            <div className="flex justify-end">
                                <div className="bg-white rounded-lg p-4 shadow-lg">
                                    <div className="flex items-center justify-between mb-3">
                                        <h2 className="text-xl font-bold text-blue-600 text-center flex-1">{currentPlayer.name}</h2>
                                        <button
                                            onClick={openTeamSelect}
                                            className="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded ml-2"
                                            disabled={!isPlayerTurn || gameOver}
                                        >
                                            Switch
                                        </button>
                                    </div>
                                    <div className="border-4 border-blue-400 rounded-lg p-6 bg-blue-50 mb-3">
                                        <div className="text-6xl">{currentPlayer.icon}</div>
                                    </div>
                                    <div className="w-40">
                                        <div className="text-xs font-bold mb-1 text-gray-700">HP</div>
                                        <div className="w-full bg-gray-200 rounded-full h-5">
                                            <div 
                                                className="bg-green-500 h-5 rounded-full transition-all duration-500 flex items-center justify-center text-white text-xs font-bold"
                                                style={{ width: `${(currentPlayer.hp / currentPlayer.maxHP) * 100}%` }}
                                            >
                                                {currentPlayer.hp > 0 && `${currentPlayer.hp}/${currentPlayer.maxHP}`}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg p-4 shadow-lg">
                            <h3 className="text-xl font-bold text-gray-800 mb-3">Skills</h3>
                            
                            <div className="grid grid-cols-2 gap-3">
                                <button
                                    onClick={() => playerAttack(currentPlayer.attacks[0].damage, currentPlayer.attacks[0].name, false)}
                                    disabled={!isPlayerTurn || gameOver}
                                    className="bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all transform hover:scale-105 disabled:transform-none"
                                >
                                    {currentPlayer.attacks[0].name}
                                    <div className="text-xs">{currentPlayer.attacks[0].damage} damage</div>
                                </button>
                                
                                <button
                                    onClick={() => playerAttack(currentPlayer.attacks[1].damage, currentPlayer.attacks[1].name, true)}
                                    disabled={!isPlayerTurn || currentPlayer.specialUsed || gameOver}
                                    className="bg-purple-500 hover:bg-purple-600 disabled:bg-gray-400 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all transform hover:scale-105 disabled:transform-none flex flex-col items-center justify-center"
                                >
                                    <div className="flex items-center gap-2">
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        <span>{currentPlayer.attacks[1].name}</span>
                                    </div>
                                    <div className="text-xs">{currentPlayer.attacks[1].damage} damage {currentPlayer.specialUsed ? "(Used!)" : "(One use!)"}</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<OfficeBattle />);
    </script>
</body>
</html>

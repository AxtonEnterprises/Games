<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horse Racing Game</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    
    #gameContainer {
      width: 100vw;
      height: 100vh;
      background-color: #15803d;
      position: relative;
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    .segment {
      position: absolute;
      width: 100%;
      height: 10%;
    }
    
    .tree {
      position: absolute;
      font-size: 2.5rem;
      top: 50%;
      transform: translateY(-50%);
    }
    
    .road {
      position: absolute;
      height: 100%;
      background-color: #4b5563;
    }
    
    .road-grid {
      position: absolute;
      inset: 0;
      display: grid;
      grid-template-columns: 1fr 1fr;
      height: 100%;
    }
    
    .road-grid-left {
      border-right: 1px solid black;
      height: 100%;
    }
    
    .center-line {
      position: absolute;
      left: 50%;
      top: 0;
      width: 8px;
      height: 100%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
    }
    
    .dash {
      flex: 1;
      width: 100%;
    }
    
    .dash-visible {
      background-color: #fbbf24;
    }
    
    .skunk {
      position: absolute;
      font-size: 2.5rem;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    .horse {
      position: absolute;
      font-size: 4rem;
      top: 75%;
      transform: translateX(-50%);
      transition: left 0.2s;
      z-index: 50;
    }
    
    .score {
      position: absolute;
      top: 1rem;
      left: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      z-index: 50;
    }
    
    .menu, .gameOver {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 50;
    }
    
    .menu-content, .gameOver-content {
      text-align: center;
      color: white;
    }
    
    h1 {
      font-size: 3.5rem;
      margin-bottom: 1rem;
    }
    
    p {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
    }
    
    .high-score {
      font-size: 1.5rem;
      color: #fbbf24;
      margin-bottom: 1rem;
    }
    
    button {
      background-color: #16a34a;
      color: white;
      font-weight: bold;
      padding: 1rem 2rem;
      border-radius: 0.5rem;
      font-size: 1.5rem;
      border: none;
      cursor: pointer;
      margin-top: 1rem;
    }
    
    button:hover {
      background-color: #15803d;
    }
    
    .game-over-reason {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    
    .game-over-score {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    
    .new-high-score {
      font-size: 1.5rem;
      color: #fbbf24;
      margin-bottom: 1rem;
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <div id="segmentsContainer"></div>
    <div id="horse" class="horse">üê¥</div>
    <div id="score" class="score hidden">Score: 0</div>
    
    <div id="menu" class="menu">
      <div class="menu-content">
        <h1>üê¥ Horse Racing</h1>
        <p>Tap left or right to move</p>
        <p>Stay on the road!</p>
        <p>Dodge the skunks!</p>
        <p id="menuHighScore" class="high-score hidden"></p>
        <button onclick="startGame()">Start Race</button>
      </div>
    </div>
    
    <div id="gameOver" class="gameOver hidden">
      <div class="gameOver-content">
        <h1 style="color: #ef4444;">Game Over!</h1>
        <p id="gameOverReason" class="game-over-reason"></p>
        <p id="finalScore" class="game-over-score"></p>
        <p id="newHighScore" class="new-high-score hidden">üèÜ New High Score! üèÜ</p>
        <button onclick="startGame()">Race Again</button>
      </div>
    </div>
  </div>

  <script>
    let gameState = 'menu';
    let score = 0;
    let highScore = 0;
    let horsePosition = 50;
    let segments = [];
    let speed = 10;
    let gameLoop = null;

    const gameContainer = document.getElementById('gameContainer');
    const segmentsContainer = document.getElementById('segmentsContainer');
    const horseEl = document.getElementById('horse');
    const scoreEl = document.getElementById('score');
    const menuEl = document.getElementById('menu');
    const gameOverEl = document.getElementById('gameOver');

    function initSegments() {
      segments = [];
      let roadCenter = 50;
      
      for (let i = 0; i < 10; i++) {
        const shift = (Math.random() - 0.5) * 10;
        roadCenter = Math.max(20, Math.min(80, roadCenter + shift));
        
        const hasSkunk = Math.random() < 0.15;
        const skunkOffset = hasSkunk ? (Math.random() - 0.5) * 25 : null;
        
        segments.push({
          id: Date.now() + i,
          roadCenter: roadCenter,
          skunk: skunkOffset,
          yPosition: i * 10
        });
      }
    }

    function renderSegments() {
      segmentsContainer.innerHTML = '';
      
      segments.forEach(segment => {
        const segmentDiv = document.createElement('div');
        segmentDiv.className = 'segment';
        segmentDiv.style.top = segment.yPosition + '%';
        
        const roadLeft = segment.roadCenter - 15;
        const roadRight = segment.roadCenter + 15;
        
        // Trees on left
        if (segment.roadCenter <= 60) {
          const tree = document.createElement('div');
          tree.className = 'tree';
          tree.style.left = '5%';
          tree.textContent = 'üå≤';
          segmentDiv.appendChild(tree);
        } else {
          const tree1 = document.createElement('div');
          tree1.className = 'tree';
          tree1.style.left = '5%';
          tree1.style.top = '30%';
          tree1.textContent = 'üå≤';
          segmentDiv.appendChild(tree1);
          
          const tree2 = document.createElement('div');
          tree2.className = 'tree';
          tree2.style.left = '15%';
          tree2.style.top = '60%';
          tree2.textContent = 'üå≤';
          segmentDiv.appendChild(tree2);
        }
        
        // Road
        const road = document.createElement('div');
        road.className = 'road';
        road.style.left = roadLeft + '%';
        road.style.width = '30%';
        
        // Grid
        const grid = document.createElement('div');
        grid.className = 'road-grid';
        const gridLeft = document.createElement('div');
        gridLeft.className = 'road-grid-left';
        grid.appendChild(gridLeft);
        grid.appendChild(document.createElement('div'));
        road.appendChild(grid);
        
        // Center line
        const centerLine = document.createElement('div');
        centerLine.className = 'center-line';
        for (let i = 0; i < 5; i++) {
          const dash = document.createElement('div');
          dash.className = 'dash' + (i % 2 === 0 ? ' dash-visible' : '');
          centerLine.appendChild(dash);
        }
        road.appendChild(centerLine);
        
        // Skunk
        if (segment.skunk !== null) {
          const skunk = document.createElement('div');
          skunk.className = 'skunk';
          skunk.style.left = (50 + (segment.skunk / 30 * 100)) + '%';
          skunk.textContent = 'ü¶®';
          road.appendChild(skunk);
        }
        
        segmentDiv.appendChild(road);
        
        // Trees on right
        if (segment.roadCenter >= 40) {
          const tree = document.createElement('div');
          tree.className = 'tree';
          tree.style.right = '5%';
          tree.style.left = 'auto';
          tree.textContent = 'üå≤';
          segmentDiv.appendChild(tree);
        } else {
          const tree1 = document.createElement('div');
          tree1.className = 'tree';
          tree1.style.right = '5%';
          tree1.style.left = 'auto';
          tree1.style.top = '30%';
          tree1.textContent = 'üå≤';
          segmentDiv.appendChild(tree1);
          
          const tree2 = document.createElement('div');
          tree2.className = 'tree';
          tree2.style.right = '15%';
          tree2.style.left = 'auto';
          tree2.style.top = '60%';
          tree2.textContent = 'üå≤';
          segmentDiv.appendChild(tree2);
        }
        
        segmentsContainer.appendChild(segmentDiv);
      });
    }

    function updateGame() {
      // Move segments down
      segments = segments.map(seg => ({
        ...seg,
        yPosition: seg.yPosition + speed * 0.15
      }));
      
      // Remove segments off screen
      segments = segments.filter(seg => seg.yPosition < 100);
      
      // Add new segments at top
      while (segments.length < 10) {
        const lastSeg = segments[0];
        const shift = (Math.random() - 0.5) * 10;
        const newRoadCenter = Math.max(20, Math.min(80, lastSeg.roadCenter + shift));
        
        const hasSkunk = Math.random() < 0.15;
        const skunkOffset = hasSkunk ? (Math.random() - 0.5) * 25 : null;
        
        segments.unshift({
          id: Date.now() + Math.random(),
          roadCenter: newRoadCenter,
          skunk: skunkOffset,
          yPosition: lastSeg.yPosition - 10
        });
      }
      
      renderSegments();
      
      // Update score
      score++;
      scoreEl.textContent = 'Score: ' + score;
      speed = Math.min(speed + 0.003, 15);
      
      // Check collisions
      const horseSegment = segments.find(seg => seg.yPosition > 70 && seg.yPosition < 80);
      
      if (horseSegment) {
        const roadLeft = horseSegment.roadCenter - 15;
        const roadRight = horseSegment.roadCenter + 15;
        
        // Check skunk collision
        if (horseSegment.skunk !== null) {
          const skunkX = horseSegment.roadCenter + horseSegment.skunk;
          if (Math.abs(skunkX - horsePosition) < 5) {
            endGame('Hit a skunk!');
            return;
          }
        }
        
        // Check tree collisions
        if (horseSegment.roadCenter <= 60) {
          if (Math.abs(horsePosition - 5) < 4) {
            endGame('Hit a tree!');
            return;
          }
        } else {
          if (Math.abs(horsePosition - 5) < 4 || Math.abs(horsePosition - 15) < 4) {
            endGame('Hit a tree!');
            return;
          }
        }
        
        if (horseSegment.roadCenter >= 40) {
          if (Math.abs(horsePosition - 95) < 4) {
            endGame('Hit a tree!');
            return;
          }
        } else {
          if (Math.abs(horsePosition - 95) < 4 || Math.abs(horsePosition - 85) < 4) {
            endGame('Hit a tree!');
            return;
          }
        }
        
        // Check out of bounds
        if (horsePosition < roadLeft || horsePosition > roadRight) {
          endGame('Out of bounds!');
          return;
        }
      }
    }

    function startGame() {
      gameState = 'playing';
      score = 0;
      horsePosition = 50;
      speed = 10;
      
      menuEl.classList.add('hidden');
      gameOverEl.classList.add('hidden');
      scoreEl.classList.remove('hidden');
      
      initSegments();
      renderSegments();
      updateHorsePosition();
      
      if (gameLoop) clearInterval(gameLoop);
      gameLoop = setInterval(updateGame, 50);
    }

    function endGame(reason) {
      gameState = 'gameOver';
      clearInterval(gameLoop);
      
      scoreEl.classList.add('hidden');
      gameOverEl.classList.remove('hidden');
      
      document.getElementById('gameOverReason').textContent = reason;
      document.getElementById('finalScore').textContent = 'Score: ' + score;
      
      if (score > highScore) {
        highScore = score;
        document.getElementById('newHighScore').classList.remove('hidden');
        document.getElementById('menuHighScore').textContent = 'High Score: ' + highScore;
        document.getElementById('menuHighScore').classList.remove('hidden');
      } else {
        document.getElementById('newHighScore').classList.add('hidden');
      }
    }

    function updateHorsePosition() {
      horseEl.style.left = horsePosition + '%';
    }

    gameContainer.addEventListener('click', (e) => {
      if (gameState !== 'playing') return;
      
      const rect = gameContainer.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const screenWidth = rect.width;
      
      if (clickX < screenWidth / 2) {
        horsePosition = Math.max(horsePosition - 6, 5);
      } else {
        horsePosition = Math.min(horsePosition + 6, 95);
      }
      
      updateHorsePosition();
    });

    // Initialize
    initSegments();
    renderSegments();
    updateHorsePosition();
  </script>
</body>
</html>
